<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>TODO ì•±</title>
    <script>
        // í˜ì´ì§€ ë¡œë”© ì‹œ, TODO ëª©ë¡ì„ AJAXë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
        function loadTodos() {
            fetch('/api/todos')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                    }
                    return response.json();
                })
                .then(data => {
                    const todoList = document.getElementById('todoList');
                    todoList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
                    data.todos.forEach(todo => {
                        const li = document.createElement('li');
                        li.innerHTML = `<strong>${todo.name}</strong> - ${todo.description}`;

                        const deleteButton = document.createElement('button');
                        deleteButton.type = 'button';
                        deleteButton.textContent = 'ğŸš€';
                        deleteButton.onclick = function() {
                            fetch(`api/todos/${todo.id}`, {
                                method: 'DELETE'
                            }).then(response => {
                                console.log(`${todo.name} - ${todo.description} ì‚­ì œë¨`);
                                loadTodos();
                            }).catch(error => {
                                console.error('Error loading todos:', error);
                                alert('ì‚­ì œ ì‹¤íŒ¨');
                            });
                        };
                        li.appendChild(deleteButton);

                        todoList.appendChild(li);
                    });
                })
                .catch(error => {
                    console.error('Error loading todos:', error);
                    alert('TODO ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        }

        // form ì œì¶œ ì‹œ AJAX í˜¸ì¶œë¡œ TODO í•­ëª© ì¶”ê°€
        function submitForm(event) {
            event.preventDefault(); // ê¸°ë³¸ form ì œì¶œ ë™ì‘ ë°©ì§€

            const name = document.getElementById('name').value;
            const description = document.getElementById('description').value;

            fetch('/api/todos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: name, description: description })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                    }
                    console.log(`${name} - ${description} ìƒì„±ë¨`);
                    return response.json();
                })
                .then(data => {
                    // ìƒˆë¡œìš´ í•­ëª© ì¶”ê°€ í›„ ì „ì²´ ëª©ë¡ ê°±ì‹ 
                    loadTodos();
                    document.getElementById('todoForm').reset();
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('TODO í•­ëª© ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('todoForm').addEventListener('submit', submitForm);
            loadTodos(); // í˜ì´ì§€ ë¡œë”© ì‹œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        });
    </script>
</head>
<body>
<h1>TODO í•­ëª© ì¶”ê°€</h1>
<form id="todoForm" th:action="@{/api/todos}" method="post">
    <label for="name">í•­ëª© ì´ë¦„:</label>
    <input type="text" id="name" name="name" required />
    <br/>
    <label for="description">í•­ëª© ì„¤ëª…:</label>
    <textarea id="description" name="description" required></textarea>
    <br/>
    <button type="submit">ì¶”ê°€</button>
</form>

<h2>í˜„ì¬ TODO ëª©ë¡</h2>
<ul id="todoList">
    <!-- AJAXë¡œ ë¶ˆëŸ¬ì˜¨ TODO í•­ëª©ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. -->
</ul>
</body>
</html>
